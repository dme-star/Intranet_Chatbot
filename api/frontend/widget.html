<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Intranet Chat Widget</title>
  <style>
    body { font-family: Arial, sans-serif; }
    #chatButton {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background: linear-gradient(135deg,#4e9af1,#3b82f6);
      color: white;
      border: none;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      cursor: pointer;
      font-size: 24px;
    }
    #chatWindow {
      position: fixed;
      right: 20px;
      bottom: 90px;
      width: 360px;
      height: 480px;
      border-radius: 12px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.3);
      background: white;
      display: none;
      overflow: hidden;
    }
    #chatHeader { padding: 12px; background: linear-gradient(90deg,#4e9af1,#3b82f6); color: white; }
    #messages { padding: 12px; height: 360px; overflow: auto; background: #f6f8fb; }
    #inputBox { display:flex; padding:8px; gap:8px; }
    #inputBox input { flex:1; padding:8px; border-radius:6px; border:1px solid #ddd; }
    #inputBox button { padding:8px 12px; background:#2563eb; color:white; border:none; border-radius:6px; }
    .msg { margin:8px 0; }
    .msg.user { text-align:right; }
    .msg.assistant { text-align:left; }
    .source { font-size:12px; color:#666; margin-top:6px; }
  </style>
</head>
<body>
<button id="chatButton">ðŸ’¬</button>

<div id="chatWindow">
  <div id="chatHeader">Intranet Assistant</div>
  <div id="messages"></div>
  <div id="inputBox">
    <input id="q" placeholder="Ask about leave policy, SOPs..." />
    <button id="send">Send</button>
  </div>
</div>

<script>
const apiBase = location.origin;
const chatButton = document.getElementById('chatButton');
const chatWindow = document.getElementById('chatWindow');
const messages = document.getElementById('messages');
const qInput = document.getElementById('q');
const sendBtn = document.getElementById('send');

chatButton.addEventListener('click', ()=> {
  if (chatWindow.style.display === 'none' || chatWindow.style.display === '') {
    chatWindow.style.display = 'block';
  } else {
    chatWindow.style.display = 'none';
  }
});

function addMessage(text, cls, source) {
  const d = document.createElement('div');
  d.className = 'msg ' + cls;
  d.innerHTML = '<div>' + text + '</div>' + (source ? '<div class="source">'+source+'</div>' : '');
  messages.appendChild(d);
  messages.scrollTop = messages.scrollHeight;
}

sendBtn.addEventListener('click', async ()=> {
  const q = qInput.value.trim();
  if (!q) return;
  addMessage(q, 'user');
  qInput.value = '';
  try {
    const res = await fetch(apiBase + '/chat', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({query: q})
    });
    const j = await res.json();
    addMessage(j.answer, 'assistant');
  } catch (e) {
    addMessage('Error contacting chatbot', 'assistant');
  }
});
</script>
</body>
</html>
